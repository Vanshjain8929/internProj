<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® / Admin</title>
</head>
<link rel="stylesheet" href="cghs.css">

<body>

    <body>
        <div class="header">
            ‡§†‡•ã‡§∏‡§æ‡§µ‡§∏‡•ç‡§•‡§æ ‡§≠‡•å‡§§‡§ø‡§ï‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§¨‡•Å‡§≤‡•á‡§ü‡§ø‡§® ‡§¨‡•ã‡§∞‡•ç‡§° / Solid State Physics Laboratory Bulletin Board
        </div>

        <div class="nav-bar">
            <div class="nav-left">
                <a href="admin.html" class="breadcrumb-link">üìã ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® / Admin </a>
            </div>
            <div class="nav-right">
                <input id="searchInput" class="search-input" type="search" placeholder="search....">
                <a href="login.html" class="login-link">‚öô Login</a>
                <span id="realtime-clock"></span>

            </div>
        </div>

        <div class="container">

            <div class="forum-header">Topics</div>

            <div class="stats-summary">
                <a href="login.html?redirect=adminnewtopic.html" class="new-topic-btn">‚ûï New Topic</a>
                <span id="topic-count">5 topics . page 1 of 1</span>
            </div>

            <div class="forum-topic-list" id="topicList">
                <!-- New topics will be inserted here dynamically -->

                <!-- Existing topics -->
                <div class="forum-topic">
                    <a href="#" class="forum-title">Admin Latest Guidelines</a>
                    <p class="topic-stat">Last post by <strong>saketmittal</strong> ‚Ä¢ 01 Jul 2024, 12:30</p>
                </div>
                <div class="forum-topic">
                    <a href="#" class="forum-title">Admin Rate List Updated</a>
                    <p class="topic-stat">Last post by <strong>saketmittal</strong> ‚Ä¢ 09 Feb 2024, 12:45</p>
                </div>
                <div class="forum-topic">
                    <a href="#" class="forum-title">Admin Own Diagnostic Laboratories</a>
                    <p class="topic-stat">Last post by <strong>saketmittal</strong> ‚Ä¢ 12 May 2022, 10:17</p>
                </div>
                <div class="forum-topic">
                    <a href="#" class="forum-title">Admin COVID-19 Orders</a>
                    <p class="topic-stat">Last post by <strong>saketmittal</strong> ‚Ä¢ 18 Jun 2020, 10:35</p>
                </div>
                <div class="forum-topic">
                    <a href="#" class="forum-title">Medical Claim Forms</a>
                    <p class="topic-stat">Last post by <strong>boardadmin</strong> ‚Ä¢ 14 Oct 2019, 09:56</p>
                </div>
            </div>

            </div>

            <div class="forum-footer">
                <div class="who-online">
                    <h4>üë§ Who is Online</h4>
                    <p>Users browsing this forum: <strong>None</strong>. No registered users and 1 guest</p>
                </div>

                <div class="forum-permissions">
                    <h4>üõ° Forum Permissions</h4>
                    <ul>
                        <li>You <strong>cannot</strong> post new topics in this forum</li>
                        <li>You <strong>cannot</strong> reply to topics in this forum</li>
                        <li>You <strong>cannot</strong> edit your posts in this forum</li>
                        <li>You <strong>cannot</strong> delete your posts in this forum</li>
                        <li>You <strong>cannot</strong> post attachments in this forum</li>
                    </ul>
                </div>
            </div>

            <div class="footer-nav">
                üè† <a href="index.html"> Return to Board Index</a>
            </div>





    </body>
    <script>
       let adminTopics = [];
let topicIdCounter = 1;
let processedTopicIds = new Set(); // Track processed topics to prevent duplicates

// Topic Counter Management
function updateTopicCounts() {
    const storedCounts = JSON.parse(localStorage.getItem('topic-count') || '{}');

    // Set default counts if not stored
    const defaultCounts = {
        'admin': 5,'cghs': 12, 'canteen': 3, 'finance': 6, 'hrd': 5, 'it': 6,
        'instrumentation': 2, 'library': 3, 'material': 6,
        'mask': 4, 'public': 5, 'qms': 4, 'sspl': 3, 'sports': 2,
        'technical': 1, 'wetcanteen': 1, 'works': 1, 'workshop': 1
    };

    const counts = { ...defaultCounts, ...storedCounts };
    localStorage.setItem('topic-count', JSON.stringify(counts));
    return counts;
}

function incrementAdminCount() {
    const counts = updateTopicCounts();
    counts.admin = (counts.admin || 5) + 1;
    localStorage.setItem('topic-count', JSON.stringify(counts));
    return counts.admin;
}

function decrementADMINCount() {
    const counts = updateTopicCounts();
    counts.admin = Math.max((counts.admin || 5) - 1, 0);
    localStorage.setItem('topic-count', JSON.stringify(counts));
    return counts.admin;
}

// Initialize topic ID counter
function initializeTopicIdCounter() {
    const storedCounter = localStorage.getItem('topicIdCounter');
    if (storedCounter) {
        topicIdCounter = parseInt(storedCounter);
    }
}

function getNextTopicId() {
    const id = topicIdCounter++;
    localStorage.setItem('topicIdCounter', topicIdCounter.toString());
    return id;
}

// Load topics from localStorage on page load
function loadStoredTopics() {
    const storedTopics = localStorage.getItem('adminTopics');
    if (storedTopics) {
        try {
            const topics = JSON.parse(storedTopics);
            adminTopics = topics;
            topics.forEach(topic => {
                if (!processedTopicIds.has(topic.id)) {
                    addNewTopicToDOM(topic);
                    processedTopicIds.add(topic.id);
                }
            });
            updateTopicCount();
        } catch (error) {
            console.error('Error loading stored topics:', error);
        }
    }
}

// Save topics to localStorage
function saveTopicsToStorage() {
    try {
        localStorage.setItem('adminTopics', JSON.stringify(adminTopics));
    } catch (error) {
        console.error('Error saving topics:', error);
    }
}

// Add new topic with counter synchronization
function addNewTopic(topicData) {
    if (adminTopics.find(t => t.id === topicData.id)) {
        console.log('Topic already exists, skipping duplicate');
        return;
    }

    if (!topicData.id) {
        topicData.id = getNextTopicId();
    }

    if (processedTopicIds.has(topicData.id)) {
        console.log('Topic already processed, skipping');
        return;
    }

    addNewTopicToDOM(topicData);
    processedTopicIds.add(topicData.id);

    adminTopics.unshift(topicData);
    saveTopicsToStorage();

    const newCount = incrementAdminCount();
    updateTopicCount();

    showSuccessMessage(`Topic posted successfully! Total ADMIN topics: ${newCount}`);

    window.dispatchEvent(new StorageEvent('storage', {
        key: 'topic-count',
        newValue: localStorage.getItem('topic-count')
    }));

    window.dispatchEvent(new CustomEvent('topicCountUpdated', {
        detail: { category: 'admin', newCount: newCount }
    }));
}

// Delete topic function
function deleteTopic(topicId) {
    if (!confirm('Are you sure you want to delete this topic? This action cannot be undone.')) {
        return;
    }

    const topicIndex = adminTopics.findIndex(t => t.id === topicId);
    if (topicIndex === -1) {
        console.error('Topic not found in array');
        return;
    }

    const topicTitle = adminTopics[topicIndex].title;
    adminTopics.splice(topicIndex, 1);

    const topicElement = document.querySelector(`[data-topic-id="${topicId}"]`);
    if (topicElement) {
        topicElement.style.animation = 'fadeOutLeft 0.5s ease-in';
        setTimeout(() => {
            topicElement.remove();
            updateTopicCount();
        }, 500);
    }

    processedTopicIds.delete(topicId);
    saveTopicsToStorage();

    const newCount = decrementADMINCount();
    showSuccessMessage(`Topic "${topicTitle}" deleted successfully! Total ADMIN topics: ${newCount}`);

    window.dispatchEvent(new StorageEvent('storage', {
        key: 'topic-count',
        newValue: localStorage.getItem('topic-count')
    }));

    window.dispatchEvent(new CustomEvent('topicCountUpdated', {
        detail: { category: 'admin', newCount: newCount }
    }));
}

// Add topic to DOM only
function addNewTopicToDOM(topicData) {
    const topicList = document.getElementById('topicList');

    const newTopicElement = document.createElement('div');
    newTopicElement.className = 'forum-topic';
    newTopicElement.setAttribute('data-topic-id', topicData.id);

    let topicTypeIcon = '';
    let specialClass = '';

    switch (topicData.type) {
        case 'sticky':
            topicTypeIcon = 'üìå ';
            specialClass = 'sticky-topic';
            break;
        case 'announce':
            topicTypeIcon = 'üì¢ ';
            specialClass = 'announce-topic';
            break;
        case 'global':
            topicTypeIcon = 'üåê ';
            specialClass = 'global-topic';
            break;
        default:
            topicTypeIcon = '';
            specialClass = 'new-topic';
    }

    const lockIcon = topicData.locked ? ' üîí' : '';
    const pollIcon = topicData.poll ? ' üìä' : '';
    const attachmentIcon = topicData.files && topicData.files.length > 0 ? ' üìé' : '';
    const topicUrl = `newtopicpage.html?id=${topicData.id}`;

    newTopicElement.innerHTML = `
    <div class="topic-content">
        <a href="${topicUrl}" class="forum-title ${specialClass}">
            ${topicTypeIcon}${topicData.title}${lockIcon}${pollIcon}${attachmentIcon}
        </a>
        <p class="topic-stat">Last post by <strong>${topicData.author}</strong> ‚Ä¢ ${topicData.date}</p>
    </div>
    <div class="topic-actions">
        <button class="delete-btn" onclick="deleteTopic(${topicData.id})" title="Delete Topic">üóëÔ∏è</button>
    </div>
    `;

    topicList.insertBefore(newTopicElement, topicList.firstChild);
    newTopicElement.style.animation = 'highlightNew 3s ease-in-out';
}

// Update topic count display
function updateTopicCount() {
    const currentTopics = document.querySelectorAll('.forum-topic').length;
    const topicCountElement = document.getElementById('topic-count');
    if (topicCountElement) {
        topicCountElement.textContent = `${currentTopics} topics . page 1 of 1`;
    }

    const counts = updateTopicCounts();
    counts.admin = currentTopics;
    localStorage.setItem('topic-count', JSON.stringify(counts));
}

// Clock functionality
function updateClock() {
    const now = new Date();
    const options = {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
    };
    const formatted = now.toLocaleString('en-GB', options).replace(',', '');
    document.getElementById('realtime-clock').textContent = formatted;
}

// Search functionality
document.getElementById('searchInput').addEventListener('input', function () {
    const query = this.value.toLowerCase();
    const topics = document.querySelectorAll('.forum-topic');
    let matchFound = false;

    topics.forEach(topic => {
        const title = topic.querySelector('.forum-title').textContent.toLowerCase();
        if (title.includes(query)) {
            topic.style.display = 'block';
            matchFound = true;
        } else {
            topic.style.display = 'none';
        }
    });

    let noResultDiv = document.getElementById('no-results');
    if (!matchFound && query.trim() !== '') {
        if (!noResultDiv) {
            noResultDiv = document.createElement('div');
            noResultDiv.id = 'no-results';
            noResultDiv.style.color = 'lightgray';
            noResultDiv.style.textAlign = 'center';
            noResultDiv.style.marginTop = '20px';
            noResultDiv.textContent = 'No results found.';
            document.querySelector('.forum-topic-list').appendChild(noResultDiv);
        }
    } else if (noResultDiv) {
        noResultDiv.remove();
    }
});

// Check for new topic in URL parameters
function checkForNewTopic() {
    const urlParams = new URLSearchParams(window.location.search);
    const newTopicData = urlParams.get('newTopic');

    if (newTopicData) {
        try {
            const topicData = JSON.parse(decodeURIComponent(newTopicData));
            if (!processedTopicIds.has(topicData.id) && !adminTopics.find(t => t.id === topicData.id)) {
                addNewTopic(topicData);
            }
            window.history.replaceState({}, document.title, window.location.pathname);
        } catch (error) {
            console.error('Error parsing topic data:', error);
        }
    }
}

// Show success message
function showSuccessMessage(message) {
    const successDiv = document.createElement('div');
    successDiv.style.cssText = `
        position: fixed; top: 20px; right: 20px;
        background: #28a745; color: white;
        padding: 15px 20px; border-radius: 8px;
        z-index: 1000; font-weight: bold;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideInRight 0.5s ease-out;
    `;
    successDiv.textContent = message;

    document.body.appendChild(successDiv);

    setTimeout(() => {
        successDiv.style.animation = 'slideOutRight 0.5s ease-in';
        setTimeout(() => {
            if (successDiv.parentNode) {
                successDiv.parentNode.removeChild(successDiv);
            }
        }, 500);
    }, 3000);
}

// Initialize page
document.addEventListener('DOMContentLoaded', function () {
    initializeTopicIdCounter();
    updateTopicCounts();
    loadStoredTopics();
    checkForNewTopic();
    setInterval(updateClock, 1000);
    updateClock();
});

// CSS animations
const style = document.createElement('style');
style.textContent = `
    .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s ease;
    }

    .delete-btn:hover {
        background: #c82333;
        transform: scale(1.05);
    }

    .delete-btn:active {
        transform: scale(0.95);
    }
`;
document.head.appendChild(style);

    </script>
</body>

</html>